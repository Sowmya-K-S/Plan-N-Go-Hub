<div class="bookings-container"> 
  <h1>My Bookings</h1>

  <!-- Current Bookings Section -->
  <h2>Current Bookings</h2>
  <div *ngIf="currentBookings.length; else noCurrentBookings">
    <div *ngFor="let booking of currentBookings" class="booking">
      <div class="booking-card">

        <!-- Image column -->
        <div class="booking-image">
          <img src="{{ booking.hotelImage }}" alt="{{ booking.hotelName }}">
        </div>

        <!-- Details columns -->
        <div class="booking-details">

          <div class="detail-column">
            <p><fa-icon [icon]="faHotel"></fa-icon> {{ booking.hotelName }}</p>
            <p><fa-icon [icon]="faMapMarkerAlt"></fa-icon> {{ booking.location }}</p>
          </div>

          <div class="detail-column">
            <p><fa-icon [icon]="faCalendarCheck"></fa-icon> {{ booking.checkIn }} -> <fa-icon [icon]="faCalendarMinus"></fa-icon> {{ booking.checkOut }}</p>
            <p><fa-icon [icon]="faUsers"></fa-icon> {{ booking.noOfGuests }} Guests</p>
          </div>

          <div class="detail-column">
            <p><fa-icon [icon]="faBed"></fa-icon>{{ booking.roomType }}</p>
            <p><fa-icon [icon]="faCircle" [style.color]="getStatusColor(booking.status)"></fa-icon> {{ booking.status }}</p>
          </div>
          
          <div class="detail-column">
            <p><fa-icon [icon]="faCloudMoon"></fa-icon> {{ booking.stayDuration }} night(s)</p>
            <p><fa-icon [icon]="faMoneyBill"></fa-icon> ₹{{ booking.totalPayable }}</p>
          </div>

          <!-- Buttons -->
          <div class="booking-buttons">
            <button (click)="openDetailsPopup(booking)">View Details</button>
            <button (click)="openCancelPopup(booking)">Cancel</button>
            <button (click)="openEditPopup(booking)">Edit Booking</button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <ng-template #noCurrentBookings>
    <p class="no-bookings">No current bookings available.</p>
  </ng-template>

  <!-- Past Bookings Section -->
  <h2>Past Bookings</h2>
  <div *ngIf="pastBookings.length; else noPastBookings">
    <div *ngFor="let booking of pastBookings" class="booking">
      <div class="booking-card">
        <!-- Image column -->
        <div class="booking-image">
          <img src="{{ booking.hotelImage }}" alt="{{ booking.hotelName }}">
        </div>

        <!-- Details columns -->
        <div class="booking-details">
          <div class="detail-column">
            <p><fa-icon [icon]="faHotel"></fa-icon> {{ booking.hotelName }}</p>
            <p><fa-icon [icon]="faMapMarkerAlt"></fa-icon> {{ booking.location }}</p>
          </div>
          <div class="detail-column">
            <p><fa-icon [icon]="faCalendarCheck"></fa-icon> {{ booking.checkIn }} -> <fa-icon [icon]="faCalendarMinus"></fa-icon> {{ booking.checkOut }}</p>
            <p><fa-icon [icon]="faUsers"></fa-icon> {{ booking.noOfGuests }} Guests</p>
          </div>
          <div class="detail-column">
            <p><fa-icon [icon]="faBed"></fa-icon> {{ booking.roomType }}</p>
            <p><fa-icon [icon]="faCircle" [style.color]="getStatusColor(booking.status)"></fa-icon>  {{ booking.status }}</p>
          </div>
          <div class="detail-column">
            <p><fa-icon [icon]="faCloudMoon"></fa-icon> {{ booking.stayDuration }} night(s)</p>
            <p><fa-icon [icon]="faMoneyBill"></fa-icon> ₹{{ booking.totalPayable }}</p>
            </div>

          <!-- Buttons -->
          <div class="booking-buttons">
           <!-- <button>View Details</button>
            <button (click)="giveReview(booking)">Give Review</button>
            <button>Book Again</button>-->
            <button (click)="openDetailsPopup(booking)">View Details</button>
            <button [disabled]="booking.status === 'cancelled'" [class.disabled]="booking.status === 'cancelled'" (click)="openReviewForm(booking)">Give Review</button>
            <button (click)="openRebookPopup(booking)">Book Again</button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <ng-template #noPastBookings>
    <p class="no-bookings">No past bookings available.</p>
  </ng-template>


  <!-- Details Popup -->
  <div class="popup" *ngIf="showDetailsPopup">
    <div class="popup-content">
      <h3>Booking Details</h3>
      <p><strong>Booking id:</strong> {{ selectedBooking?.id }}</p>
      <p><strong>Hotel id:</strong> {{ selectedBooking?.hotelid }}</p>
      <p><strong>Hotel:</strong> {{ selectedBooking?.hotelName }}</p>
      <p><strong>Location:</strong> {{ selectedBooking?.location }}</p>
      <p><strong>Booking Dates:</strong> {{ selectedBooking?.checkIn }} to {{ selectedBooking?.checkOut }}</p>
      <p><strong>Room Type:</strong> {{ selectedBooking?.roomType }}</p>
      <p><strong>No of Rooms:</strong> {{ selectedBooking?.rooms }}</p>
      <p><strong>No of Guests:</strong> {{ selectedBooking?.noOfGuests }}</p>
      <p><strong>Stay Duration:</strong> {{ selectedBooking?.stayDuration }} night(s) </p>
      <p><strong>Total Price (incl. taxes):</strong> ₹{{ selectedBooking?.totalPayable }}</p>
      <p><strong>Status:</strong> {{ selectedBooking?.status }}</p>
      
    
      <button (click)="closeDetailsPopup()" style="color: white;">Close</button>
    </div>
  </div>

  <!-- Review Form -->
  <div class="popup" *ngIf="showReviewForm">
    <div class="popup-content">
      <h3>Submit Review</h3>
      <form (ngSubmit)="submitReview()">
        <label>
          Name:
          <input type="text" [(ngModel)]="reviewForm.username" name="username" required />
        </label>
        <label>
          Rating:
          <select [(ngModel)]="reviewForm.rating" name="rating" required>
            <option *ngFor="let r of [1, 2, 3, 4, 5]" [value]="r">{{ r }}</option>
          </select>
        </label>
        <label>
          Comment:
          <textarea [(ngModel)]="reviewForm.comment" name="comment" required></textarea>
        </label>
        <button type="submit">Submit</button>
        <button type="button" (click)="closeReviewForm()">Cancel</button>
      </form>
    </div>
  </div>


  <!-- Edit Booking Popup -->
<div class="popup" *ngIf="showEditPopup">
  <div class="popup-content">
    <h3>Edit Booking</h3>
    <form (ngSubmit)="submitEditForm()">
      <!-- Main Guest Information -->
      <label>
        Name:
        <input type="text" [(ngModel)]="editForm.name" name="name" required />
      </label>
      <label>
        Age:
        <input type="number" [(ngModel)]="editForm.age" name="age" required />
      </label>
      <label>
        Gender:
        <select [(ngModel)]="editForm.gender" name="gender" required>
          <option value="male">Male</option>
          <option value="female">Female</option>
        </select>
      </label>
      <label>
        Email:
        <input type="email" [(ngModel)]="editForm.email" name="email" required />
      </label>
      <label>
        Phone:
        <input type="tel" [(ngModel)]="editForm.phone" name="phone" required />
      </label>

      <!-- Room Type Dropdown -->
      <label>
        Room Type:
        <select [(ngModel)]="editForm.roomType" name="roomType" (change)="onRoomTypeChange($event)" required>
          <option *ngFor="let room of availableRooms" [value]="room.type">
            {{ room.type }} (₹{{ room.price }})
          </option>
        </select>
      </label>

      <!-- Guest Details -->
      <div>
        <h4>Guests</h4>
        <div *ngFor="let guest of editForm.guests; let i = index" class="guest-entry">
          <label>
            Name:
            <input type="text" [(ngModel)]="guest.name" [name]="'guestName' + i" required />
          </label>
          <label>
            Age:
            <input type="number" [(ngModel)]="guest.age" [name]="'guestAge' + i" required />
          </label>
          <label>
            Gender:
            <select [(ngModel)]="guest.gender" [name]="'guestGender' + i" required>
              <option value="male">Male</option>
              <option value="female">Female</option>
            </select>
          </label>
          <button type="button" (click)="removeGuest(i)">Remove</button>
        </div>
        <button type="button" (click)="addGuest()">Add Guest</button>
      </div>

      <!-- Price and Dates -->
      <label>
        Check-In Date:
        <input type="date" [(ngModel)]="editForm.checkIn" name="checkIn" (change)="updatePrice()" required />
      </label>
      <label>
        Check-Out Date:
        <input type="date" [(ngModel)]="editForm.checkOut" name="checkOut" (change)="updatePrice()" required />
      </label>
      <label>
        Total Payable: ₹{{ editForm.totalPayable }}
      </label>

      <button type="submit">Submit</button>
      <button type="button" (click)="closeEditPopup()">Cancel</button>
    </form>
  </div>
</div>


  <!-- Rebooking Popup -->
  <!-- <div *ngIf="showRebookPopup" class="popup">
  <div class="popup-content">
    <h3>Rebook Hotel</h3>
    <form (ngSubmit)="submitRebookForm()">
      <label>Hotel Name:</label>
      <input type="text" [(ngModel)]="rebookForm.hotelName" name="hotelName" readonly />

      <label>Location:</label>
      <input type="text" [(ngModel)]="rebookForm.location" name="location" readonly />

      <label>Check-In:</label>
      <input type="date" [(ngModel)]="rebookForm.checkIn" name="checkIn" required />

      <label>Check-Out:</label>
      <input type="date" [(ngModel)]="rebookForm.checkOut" name="checkOut" required />

      <label>Room Type:</label>
      <input type="text" [(ngModel)]="rebookForm.roomType" name="roomType" readonly />

      <label>Total Payable:</label>
      <input type="number" [(ngModel)]="rebookForm.totalPayable" name="totalPayable" readonly />

      <button type="submit" class="btn btn-success">Confirm Rebooking</button>
      <button type="button" (click)="closeRebookPopup()" class="btn btn-secondary">Cancel</button>
    </form>
  </div>
  </div>
  </div> -->

  <div *ngIf="showCancelPopup" class="popup">
    <div class="popup-content popup-content-cancel">
      <h3>Confirm Cancellation</h3>
      <p>Are you sure you want to cancel this booking?</p>
      <div class="popup-buttons">
        <button type="button" (click)="closeCancelPopup()" class="btn">No</button>
        <button type="submit" (click)="confirmCancellation()" class="btn">Yes</button>
      </div>
    </div>
  </div>


  <!-- Review Submission Success Popup -->
  <div *ngIf="showReviewSuccessPopup" class="popup">
    <div class="popup-content">
      <h3>Sucess</h3>
      <p>Review submitted successfully</p>
      <button (click)="closeReviewSuccessPopup()">OK</button>
    </div>
  </div>

  <!-- Cancellation Success Popup -->
  <div *ngIf="showCancelSuccessPopup" class="popup">
    <div class="popup-content">
      <h3>Booking Cancelled Successfully</h3>
      <button (click)="closeCancelSuccessPopup()">OK</button>
    </div>
  </div>

  <!-- Update Success Popup -->
  <div *ngIf="showUpdateSuccessPopup" class="popup">
    <div class="popup-content">
      <h3>Booking Updated Successfully</h3>
      <button (click)="closeUpdateSuccessPopup()">OK</button>
    </div>
  </div>
  
  <app-navigation-toggle></app-navigation-toggle>

